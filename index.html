<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Araucária Florestal – Gestão de Pneus (SISMA)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- LIBS -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- STYLE -->
  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2e;
      --card-soft: #0f172a;
      --primary: #22c55e;
      --secondary: #3b82f6;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #e5e7eb;
      --muted: #94a3b8;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(180deg, #020617, #0b1220);
      color: var(--text);
    }

    header {
      padding: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #1e293b;
    }

    header h1 {
      font-size: 22px;
      margin: 0;
      font-weight: 600;
    }

    .upload {
      background: var(--card);
      padding: 14px 18px;
      border-radius: 10px;
      cursor: pointer;
      border: 1px dashed #334155;
    }

    .upload input {
      display: none;
    }

    main {
      padding: 24px;
      display: grid;
      gap: 24px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    .card {
      background: linear-gradient(180deg, var(--card), var(--card-soft));
      padding: 18px;
      border-radius: 14px;
      border: 1px solid #1e293b;
    }

    .card span {
      color: var(--muted);
      font-size: 13px;
    }

    .card strong {
      display: block;
      font-size: 28px;
      margin-top: 6px;
    }

    .charts {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }

    @media (min-width: 900px) {
      .charts {
        grid-template-columns: 1fr 1fr;
      }
    }

    canvas {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid #1e293b;
    }

    .insights {
      background: var(--card);
      padding: 20px;
      border-radius: 16px;
      border: 1px solid #1e293b;
    }

    .insights h2 {
      margin-top: 0;
      font-size: 18px;
    }

    .insights ul {
      padding-left: 18px;
      margin: 0;
    }

    .insights li {
      margin-bottom: 10px;
      color: var(--muted);
    }
  </style>
</head>

<body>

<header>
  <h1>Araucária Florestal – Gestão de Pneus (SISMA)</h1>
  <label class="upload">
    Carregar Inventário SISMA (CSV)
    <input type="file" id="fileInput" accept=".csv">
  </label>
</header>

<main>

  <!-- CARDS -->
  <section class="cards">
    <div class="card">
      <span>Total de Pneus</span>
      <strong id="totalPneus">0</strong>
    </div>
    <div class="card">
      <span>Estados Ativos</span>
      <strong id="totalEstados">0</strong>
    </div>
    <div class="card">
      <span>Fabricantes</span>
      <strong id="totalFabricantes">0</strong>
    </div>
    <div class="card">
      <span>Vidas Identificadas</span>
      <strong id="totalVidas">0</strong>
    </div>
  </section>

  <!-- GRÁFICOS -->
  <section class="charts">
    <canvas id="graficoEstado"></canvas>
    <canvas id="graficoVida"></canvas>
  </section>

  <!-- INSIGHTS -->
  <section class="insights">
    <h2>Insights Automáticos</h2>
    <ul id="listaInsights"></ul>
  </section>

</main>

<script>
let dados = [];
let chartEstado, chartVida;

document.getElementById("fileInput").addEventListener("change", e => {
  Papa.parse(e.target.files[0], {
    header: true,
    skipEmptyLines: true,
    complete: r => {
      dados = r.data;
      atualizarDashboard();
    }
  });
});

function contarPor(campo) {
  const map = {};
  dados.forEach(d => {
    const k = d[campo] || "Não informado";
    map[k] = (map[k] || 0) + 1;
  });
  return map;
}

function atualizarDashboard() {
  document.getElementById("totalPneus").innerText = dados.length;

  const estados = contarPor("Estado");
  const vidas = contarPor("Vida");
  const fabricantes = contarPor("Fabricante");

  document.getElementById("totalEstados").innerText = Object.keys(estados).length;
  document.getElementById("totalVidas").innerText = Object.keys(vidas).length;
  document.getElementById("totalFabricantes").innerText = Object.keys(fabricantes).length;

  gerarGrafico("graficoEstado", estados, "Distribuição por Estado", chartEstado, c => chartEstado = c);
  gerarGrafico("graficoVida", vidas, "Distribuição por Vida", chartVida, c => chartVida = c);

  gerarInsights(estados, fabricantes, vidas);
}

function gerarGrafico(id, map, titulo, chartRef, setRef) {
  const labels = Object.keys(map);
  const values = Object.values(map);

  if (chartRef) chartRef.destroy();

  setRef(new Chart(document.getElementById(id), {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: titulo,
        data: values,
        backgroundColor: "#3b82f6"
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: titulo,
          color: "#e5e7eb"
        },
        legend: { display: false }
      },
      scales: {
        x: { ticks: { color: "#cbd5f5" } },
        y: { ticks: { color: "#cbd5f5" } }
      }
    }
  }));
}

function gerarInsights(estados, fabricantes, vidas) {
  const ul = document.getElementById("listaInsights");
  ul.innerHTML = "";

  const topEstado = Object.entries(estados).sort((a,b)=>b[1]-a[1])[0];
  const topFabricante = Object.entries(fabricantes).sort((a,b)=>b[1]-a[1])[0];
  const topVida = Object.entries(vidas).sort((a,b)=>b[1]-a[1])[0];

  ul.innerHTML += `<li>Maior concentração de pneus no estado <b>${topEstado[0]}</b> (${topEstado[1]} pneus).</li>`;
  ul.innerHTML += `<li>Fabricante mais presente: <b>${topFabricante[0]}</b> (${topFabricante[1]} pneus).</li>`;
  ul.innerHTML += `<li>Vida predominante: <b>${topVida[0]}</b> (${topVida[1]} pneus).</li>`;
}
</script>

</body>
</html>


